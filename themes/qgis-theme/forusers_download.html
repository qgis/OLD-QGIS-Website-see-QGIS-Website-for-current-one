<section class="intro">
    <div class="container">
        <h2>{{ _('Download QGIS for your platform') }}</h2>
        <p class="main">{{ _('Binary packages (installers) are available from this page.') }}</p>
        <p class="main">{{ _('The current version is QGIS %s \'%s\' and was released on %s.')|format( release, codename, releasedate.strftime('%d.%m.%Y') ) }}</p>
        <p class="main">{{ _('The long-term repositories currently offer QGIS %s \'%s\'.')|format( ltrrelease, ltrcodename ) }}</p>
        <p class="main">{{ _('QGIS is available on Windows, macOS, Linux, Android and iOS.') }}</p>
{% if infeaturefreeze == True %}
        <p class="main">
          {{ _('We are currently in feature freeze preceeding the release of QGIS %s. <b>Please consider testing the prereleases</b>. See ')|format(nextversion) }}
	  <a href="{{ pathto('site/getinvolved/development/roadmap') }}#location-of-prereleases-nightly-builds">{{ _("road map") }}</a>.
        </p>
{% endif %}
    </div>
</section>
<section class="content">
    <div class="container">
        <ul class="nav nav-tabs" id="tabs">
          <li class="active"><a href="#tab1">{{ _('Installation Downloads') }}</a></li>
          <li><a href="#tab2">{{ _('All Releases') }}</a></li>
          <li><a href="#tab3">{{ _('Sources') }}</a></li>
        </ul>

        <div class="tab-content">

          <!-- Tab 1 -->
          <div class="tab-pane active" id="tab1">
            <!-- Downloads Accordion -->
              <a name="windows"></a>
              <div class="accordion" id="downloads">
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#downloads" href="#windows">
                      <h4>{{ _('Download for Windows') }} <i class="icon-chevron-down pull-right"></i></h4>
                    </a>
                  </div>
                  <div id="windows" class="accordion-body collapse in">
                    <div class="accordion-inner centered">
                      <a class="reference btn btn-large btn-success" href="{{ lr_msi|e }}">
                        <div class="primary-download-button">
                          <div class="qgis-download"></div>
                          <div class="download-text">{{ _('Download QGIS %s')|format( version ) }}</div>
                        </div>
                      </a>
                      <a class="reference secondary-download-link" href="{{ ltr_msi|e }}">
                        {{ _('Looking for the most stable version? Get QGIS %s %s')|format( ltrversion, ltrnote ) }}
                      </a>
                      <br/>
                      <a class="reference secondary-download-link" href="{{ pathto('site/forusers/alldownloads') }}#osgeo4w-installer">
                        <div class="primary-download-button">
                          <div class="osgeo-download"></div>
			  &nbsp;&nbsp;{{ _('OSGeo4W Network Installer') }}
                        </div>
                      </a>
			</li>
                      <p>
                         {{ _('The OSGeo4W installer is recommended for regular users or organization deployments. <em>It allows to have several QGIS versions in one place, and to keep each component up-to-date individually without having to download the whole package.</em>') }}
		         <br>
                         <br>
                         <small>{{ _('Starting from 3.22, QGIS requires Windows 8 64 bit or higher because QGIS uses Python 3.9 or later, which is not available for Windows 7.') }}</small>
		      </p>
                    </div>
                  </div>
                </div>
                <a name="mac"></a>
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#downloads" href="#mac">
                      <h4>{{ _('Download for macOS') }} <i class="icon-chevron-down pull-right"></i></h4>
                    </a>
                  </div>
                  <div id="mac" class="accordion-body collapse in">
                    <div class="accordion-inner centered">
                      <a class="reference btn btn-large btn-success" href="https://qgis.org/downloads/macos/qgis-macos-pr.dmg">
                        <div class="primary-download-button">
                          <div class="qgis-download"></div>
                          <div class="download-text">{{ _('Download QGIS %s')|format( version ) }}</div>
                        </div>
                      </a>
                      <a class="reference secondary-download-link" href="https://qgis.org/downloads/macos/qgis-macos-ltr.dmg">
                        {{ _('Looking for the most stable version? Get QGIS %s %s')|format( ltrversion, ltrnote ) }}
                      </a>
                      <p><em>{{ _('macOS High Sierra (10.13) or newer is required. QGIS is not yet notarized as required by macOS Catalina (10.15) security rules. On first launch, please right-click on the QGIS app icon, hold down the Option key, then choose Open.') }}</em></p>
                    </div>
                  </div>
                </div>
                <a name="linux"></a>
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#downloads" href="#linux">
                      <h4>{{ _('Download for Linux') }} <i class="icon-chevron-down pull-right"></i></h4>
                    </a>
                  </div>
                  <div id="linux" class="accordion-body collapse in">
                    <div class="accordion-inner">
                      <p>{{ _('For many flavors of GNU/Linux binary packages (rpm and deb) or software repositories (to add to your installation manager) are available. Please select your choice of distro below:') }}</p>
                      <ul>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#debian-ubuntu">{{ _('Debian/Ubuntu') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#fedora">{{ _('Fedora') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#suse-opensuse">{{ _('openSUSE') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#mandriva">{{ _('Mandriva') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#slackware">{{ _('Slackware') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#arch-linux">{{ _('Arch Linux') }}</a></li>
                      <li><a href="{{ pathto('site/forusers/alldownloads') }}#flatpak">{{ _('Flatpak') }}</a></li>
                      </ul>
                      <p class="download-text"><a href="{{ pathto('site/forusers/alldownloads') }}#linux">{{ _('Linux Installation Instructions') }}</a></p>
                    </div>
                  </div>
                </div>
                <a name="bsd"></a>
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#downloads" href="#bsd">
                      <h4>{{ _('Download for BSD') }} <i class="icon-chevron-down pull-right"></i></h4>
                    </a>
                  </div>
                  <div id="bsd" class="accordion-body collapse in">
                    <div class="accordion-inner">
                      <p class="download-text"><a href="{{ pathto('site/forusers/alldownloads') }}#freebsd">{{ _('BSD Installation Instructions') }} </a></p>
                    </div>
                  </div>
                </div>
                <a name="apps"></a>
                <div class="accordion-group">
                  <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#downloads" href="#apps">
                      <h4>{{ _('Apps for mobile and tablet') }} <i class="icon-chevron-down pull-right"></i></h4>
                    </a>
                  </div>
                  <div id="apps" class="accordion-body collapse in">
                    <div class="accordion-inner">
                        <p>{{ _('The QGIS experience does not stop on the desktop. Various touch optimized apps allow you to take QGIS into the field') }}</p>
                        <h4>{{ _('Third-party touch optimized apps') }}</h4>
                        <h5 class="app-name"><a href="https://qfield.org">{{ _('QField (Android, iOS, Windows, macOS, Linux)') }}</a></h5>
                        <div class='app-download-buttons clearfix'>
                            <a class='app-download-button' href='https://play.google.com/store/apps/details?id=ch.opengis.qfield&utm_source=qgis.org'><img alt='Get it on Google Play' src="{{pathto('_static/images/app_download_play_store.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://qfield.org/get'><img alt='Get it for iOS' src="{{pathto('_static/images/app_download_apple_store.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://qfield.org/get'><img alt='Get it for Windows' src="{{pathto('_static/images/app_download_windows.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://www.github.com/opengisch/qfield/releases'><img alt='Get it on GitHub' src="{{pathto('_static/images/app_download_gh.png', 1)}}"/></a>
                        </div>
                        <h5 class="app-name"><a href="https://merginmaps.com/">{{ _('Mergin Maps Input app (available for Android, iOS and Windows devices)') }}</a></h5>
                        <div class='app-download-buttons clearfix'>
                            <a class='app-download-button' href='https://play.google.com/store/apps/details?id=uk.co.lutraconsulting&utm_source=qgis.org'><img alt='Get it on Google Play' src="{{pathto('_static/images/app_download_play_store.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://apps.apple.com/us/app/input/id1478603559'><img alt='Get it for iOS' src="{{pathto('_static/images/app_download_apple_store.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://www.github.com/MerginMaps/input/releases'><img alt='Get it for Windows' src="{{pathto('_static/images/app_download_windows.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://www.github.com/MerginMaps/input/releases'><img alt='Get it on GitHub' src="{{pathto('_static/images/app_download_gh.png', 1)}}"/></a>
                        </div>
                        <h5 class="app-name"><a href="https://roam-docs.readthedocs.io">IntraMaps Roam</a></h5>
                        <div class='app-download-buttons clearfix'>
                            <a class='app-download-button' href='https://github.com/roam-qgis/Roam/releases'><img alt='Get it for Windows' src="{{pathto('_static/images/app_download_windows.png', 1)}}"/></a>
                            <a class='app-download-button' href='https://github.com/roam-qgis/Roam/releases'><img alt='Get it on GitHub' src="{{pathto('_static/images/app_download_gh.png', 1)}}"/></a>
                        </div>
                        <h4 class="app-name">{{ _('QGIS for Android') }}</h4>
                        <p>{{ _('An old and deprecated not touch optimised release of QGIS for Android can be found in') }}<a href="{{ pathto('site/forusers/alldownloads') }}#android">{{ _('All downloads') }}</a></p>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End Accordion -->

              <h4>{{ _('All downloads') }}</h4>
              <p>
                {{ _('More specific instructions about downloading QGIS stable vs QGIS development can be found in') }} <a href="{{ pathto('site/forusers/alldownloads') }}">{{ _('All downloads') }}</a>.
              </p>

              <h4>{{ _('Datasets') }}</h4>
              <p>{{ _('For testing and learning purposes, a ') }} <a href="https://docs.qgis.org/latest/{{language}}/docs/user_manual/introduction/getting_started.html#downloading-sample-data"><strong>{{ _('sample dataset is available') }}</strong></a>, {{ _('which contains collections of data from different sources and in different formats.') }}</p>

          </div>

          <!-- Tab 2 -->
          <div class="tab-pane" id="tab2">
              <p>{{ _('Previous releases of QGIS are still available') }} <a href="https://qgis.org/downloads">{{ _('here') }}</a> {{ _(' - including older releases for OS X ') }}
              <a href="https://qgis.org/downloads/macOS/">{{ _('here') }}</a>.</p>
              <p>{{ _('More older releases are available') }} <a href="https://download.osgeo.org/qgis/" class="reference external">{{ _('here') }}</a>
              {{ _('and') }}
              {{ _('for OS X ') }} <a href="https://www.kyngchaos.com/software/archive/" class="reference external">{{ _('here') }}</a>.</p>
              <p>{{ _('Plugins for QGIS are also available ') }}<a href="https://plugins.qgis.org/plugins/" class="reference external">{{ _('here') }}</a>.</p>
          </div>

          <!-- Tab 3 -->
          <div class="tab-pane" id="tab3">
              <p>{{ _('QGIS is open source software available under the terms of the') }} <b>{{ _('GNU General Public License') }}</b> {{ _('meaning that its source code can be downloaded through tarballs or the git repository.') }}</p>
              <p>{{ _('QGIS Source Code is available ') }}
                 <a href="https://qgis.org/downloads/qgis-latest.tar.bz2">{{ _('here (latest release)') }}</a>
                 {{ _('and') }}
                 <a href="https://qgis.org/downloads/qgis-latest-ltr.tar.bz2">{{ _('here (long term release)') }}</a></p>
              <p>{{ _('Refer to the INSTALL guide on how to compile QGIS from source for the different platforms:') }} <a href="https://github.com/qgis/QGIS/blob/master/INSTALL.md"  class="reference external">{{ _('here') }}</a></p>
          </div>
        </div>

        <script>

          $(function () {
            $('#tabs a').click(function (e) {
              e.preventDefault();
              $(this).tab('show');
            });

            // Detect browser and open accordion tab for that os
            var os = "unknown";
			if (navigator.platform.toUpperCase().indexOf("WIN")!=-1) os="windows";
			if (navigator.platform.toUpperCase().indexOf("MAC")!=-1) os="mac";
			if (navigator.platform.toUpperCase().indexOf("X11")!=-1) os="unix";
			if (navigator.platform.toUpperCase().indexOf("LINUX")!=-1) os="linux";
			if (navigator.platform.toUpperCase().indexOf("BSD")!=-1) os="bsd";
			if (navigator.platform.toUpperCase().indexOf("ANDROID")!=-1) os="apps";

            // Add handler for accordion toggles
            $('.accordion-toggle').click(function(){
                var el = $(this).find("i");
                if (el.hasClass("icon-chevron-down")) {
                  el.removeClass("icon-chevron-down")
                    .addClass("icon-chevron-left");
                } else {
                  el.removeClass("icon-chevron-left")
                    .addClass("icon-chevron-down");
                }
            });

            // Close unrelated if 1. hash tag is detected or 2. os is detected
            var url = window.location.hash;
            var hash = url.substring(url.lastIndexOf('#'), url.length);
            var look_for = (hash == "" || hash == -1) ? os : hash.substring(1, hash.length);

            $('.accordion-body').each(function(){
              if ($(this).attr('id').toLowerCase() !== look_for) {
                $(this).prev().children(":first-child").click();
              }
            });


          })
        </script>
    </div>
</section>
